# üîç –ù–∞—Å—Ç—Ä–æ–π–∫–∞ OCR

## –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

OCR —Å Tesseract.js –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –Ω–æ –º–æ–∂–µ—Ç –≤–æ–∑–Ω–∏–∫–∞—Ç—å –ø—Ä–æ–±–ª–µ–º–∞ —Å Web Workers –≤ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π —Å—Ä–µ–¥–µ Next.js.

## –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ç–µ–∫—É—â–∏–π —Å–µ—Ä–≤–µ—Ä (Ctrl+C)
# –û—á–∏—Å—Ç–∏—Ç–µ –∫–µ—à
Remove-Item -Path .next -Recurse -Force

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∑–∞–Ω–æ–≤–æ
npm run dev
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –í—Ä–µ–º–µ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Mock –¥–∞–Ω–Ω—ã–µ

–ï—Å–ª–∏ OCR –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –≤–µ—Ä–Ω–∏—Ç–µ—Å—å –∫ mock –¥–∞–Ω–Ω—ã–º –≤ `app/api/documents/upload/route.ts`:
- –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å—Ç—Ä–æ–∫–∏ 134-157 (—Ä–µ–∞–ª—å–Ω—ã–π OCR)
- –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å—Ç—Ä–æ–∫–∏ 159-163 (mock –¥–∞–Ω–Ω—ã–µ)

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–Ω–µ—à–Ω–∏–π OCR API

–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±–ª–∞—á–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã:

#### Google Cloud Vision API
```typescript
import vision from '@google-cloud/vision'

const client = new vision.ImageAnnotatorClient()
const [result] = await client.textDetection(imageData)
const text = result.fullTextAnnotation?.text
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å (95-99%)
- ‚úÖ –û—Ç–ª–∏—á–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
- ‚úÖ –ë—ã—Å—Ç—Ä–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
- ‚ö†Ô∏è –ü–ª–∞—Ç–Ω—ã–π (–ø–µ—Ä–≤—ã–µ 1000 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–µ—Å—è—Ü –±–µ—Å–ø–ª–∞—Ç–Ω–æ)

#### AWS Textract
```typescript
import { TextractClient, AnalyzeDocumentCommand } from "@aws-sdk/client-textract"

const client = new TextractClient({ region: "us-east-1" })
const command = new AnalyzeDocumentCommand({
  Document: { Bytes: imageBuffer },
  FeatureTypes: ["TABLES", "FORMS"]
})
const response = await client.send(command)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö
- ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –∏ —Ñ–æ—Ä–º
- ‚úÖ –í—ã—Å–æ–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å
- ‚ö†Ô∏è –ü–ª–∞—Ç–Ω—ã–π

#### Azure Computer Vision
```typescript
import { ComputerVisionClient } from "@azure/cognitiveservices-computervision"

const client = new ComputerVisionClient(credentials, endpoint)
const result = await client.readInStream(imageStream)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –•–æ—Ä–æ—à–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä—É—Å—Å–∫–æ–≥–æ
- ‚úÖ –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
- ‚ö†Ô∏è –ü–ª–∞—Ç–Ω—ã–π

## –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### next.config.mjs
–î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è webpack –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Tesseract.js:
- Fallback –¥–ª—è node modules
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Å–µ—Ä–≤–µ—Ä–Ω–æ–π —Å—Ä–µ–¥—ã

### lib/ocr.ts
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç `createWorker` –¥–ª—è Node.js –æ–∫—Ä—É–∂–µ–Ω–∏—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º lifecycle.

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

–ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª:

### –£—Å–ø–µ—à–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞:
```
[OCR] Starting text recognition...
[OCR] Progress: 0%
[OCR] Progress: 25%
[OCR] Progress: 50%
[OCR] Progress: 75%
[OCR] Progress: 100%
[OCR] Recognition completed with 87% confidence
[PARSER] Starting medical data extraction...
[PARSER] Extracted: type=–û–±—â–∏–π –∞–Ω–∞–ª–∏–∑ –∫—Ä–æ–≤–∏, indicators=4
[OCR] Real OCR completed for document xxx
```

### –û—à–∏–±–∫–∞:
```
Error: Cannot find module '.next/worker-script/node/index.js'
[OCR] Recognition error: ...
```

–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫—É - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –í–∞—Ä–∏–∞–Ω—Ç 2 (mock –¥–∞–Ω–Ω—ã–µ) –∏–ª–∏ –í–∞—Ä–∏–∞–Ω—Ç 3 (–æ–±–ª–∞—á–Ω—ã–π API).

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–±–ª–∞—á–Ω—ã–π OCR API** (Google Vision, AWS Textract)
2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –æ—á–µ—Ä–µ–¥—å –æ–±—Ä–∞–±–æ—Ç–∫–∏** (Bull, BullMQ)
3. **–î–æ–±–∞–≤—å—Ç–µ retry –ª–æ–≥–∏–∫—É** –¥–ª—è failed jobs
4. **–ö–µ—à–∏—Ä—É–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã** OCR
5. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** —Å—Ç–æ–∏–º–æ—Å—Ç–∏ API –≤—ã–∑–æ–≤–æ–≤

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: OCR.space API

–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π API –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Å–ª—É—á–∞–µ–≤:

```typescript
const formData = new FormData()
formData.append('base64Image', imageData)
formData.append('language', 'rus')

const response = await fetch('https://api.ocr.space/parse/image', {
  method: 'POST',
  headers: { 'apikey': process.env.OCR_SPACE_API_KEY },
  body: formData
})
```

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- 25,000 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–µ—Å—è—Ü –±–µ—Å–ø–ª–∞—Ç–Ω–æ
- –°—Ä–µ–¥–Ω—è—è —Ç–æ—á–Ω–æ—Å—Ç—å
- –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ø—Ä–æ—Ç–æ—Ç–∏–ø–∏—Ä–æ–≤–∞–Ω–∏—è

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: Module not found
**–†–µ—à–µ–Ω–∏–µ:** –û—á–∏—Å—Ç–∏—Ç–µ `.next` –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ

### –ü—Ä–æ–±–ª–µ–º–∞: Out of memory
**–†–µ—à–µ–Ω–∏–µ:** –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –≤ —Ñ–æ–Ω–µ

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–∏–∑–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å
**–†–µ—à–µ–Ω–∏–µ:** 
- –£–ª—É—á—à–∏—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–±–ª–∞—á–Ω—ã–π API
- –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–∫–æ–Ω—Ç—Ä–∞—Å—Ç, —è—Ä–∫–æ—Å—Ç—å)

## –ö–æ–Ω—Ç–∞–∫—Ç—ã

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å OCR –Ω–µ —Ä–µ—à–∞—é—Ç—Å—è:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏—é Tesseract.js
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–ª–∞—á–Ω—ã–π API
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ mock –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –¥—Ä—É–≥–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π

