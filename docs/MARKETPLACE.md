# Модуль 5: Персонализированные предложения (Маркетплейс)

## Обзор

Модуль маркетплейса предоставляет персонализированные рекомендации на основе анализа медицинских данных пользователя. Система анализирует профиль пользователя, историю исследований, выявленные риски и формирует релевантные предложения от партнерских компаний.

## Функциональность

### 1. Каталог компаний

- **Типы компаний**: Клиники, лаборатории, аптеки, магазины здорового питания, фитнес-центры, диетологи
- **Информация о компаниях**: Название, описание, адрес, контакты, рейтинг, услуги, рабочие часы
- **Поиск и фильтрация**: По типу, городу, названию
- **Верификация**: Проверенные партнеры отмечены специальным бейджем

### 2. AI-рекомендации

#### Пассивный запрос
Система автоматически анализирует:
- Результаты анализов с отклонениями
- Выявленные риски для здоровья
- Рекомендации врачей
- Историю взаимодействий с рекомендациями

#### Типы рекомендаций
- **ANALYSIS**: Повторные анализы
- **SUPPLEMENT**: Биодобавки и витамины
- **SERVICE**: Медицинские услуги
- **ARTICLE**: Обучающие материалы
- **PRODUCT**: Товары для здоровья

#### Примеры рекомендаций
- Низкий уровень витамина D → лаборатории для анализа + биодобавки
- Низкий гемоглобин → консультация гематолога + препараты железа
- Повышенный холестерин → консультация кардиолога + диетолог

## Техническая архитектура

### База данных

#### Модели
- `Company`: Информация о компаниях-партнерах
- `Product`: Товары и услуги компаний
- `Recommendation`: Персонализированные рекомендации
- `RecommendationInteraction`: История взаимодействий

#### Связи
- Рекомендации связаны с анализами, компаниями и продуктами
- Отслеживание взаимодействий для улучшения алгоритма

### API Endpoints

#### Компании
- `GET /api/marketplace/companies` - Каталог компаний
- `GET /api/marketplace/companies/[id]` - Детали компании
- `POST /api/marketplace/companies` - Создание компании (админ)

#### Рекомендации
- `GET /api/marketplace/recommendations` - Список рекомендаций
- `POST /api/marketplace/recommendations` - Создание рекомендации
- `POST /api/marketplace/recommendations/generate` - Генерация новых рекомендаций
- `POST /api/marketplace/recommendations/[id]/interact` - Взаимодействие с рекомендацией

### AI-движок рекомендаций

#### Правила рекомендаций
1. **Дефицит витамина D**: Анализ + добавки
2. **Низкий гемоглобин**: Гематолог + препараты железа
3. **Повышенный холестерин**: Кардиолог + диетолог
4. **Множественные отклонения**: Комплексное обследование

#### Приоритизация
- Приоритет 1-5 (5 - высший)
- Сортировка по приоритету и дате создания
- Истечение рекомендаций через 30 дней

## Пользовательский интерфейс

### Страницы
- `/marketplace` - Каталог компаний
- `/marketplace/recommendations` - Персонализированные рекомендации

### Функции
- Поиск и фильтрация компаний
- Просмотр детальной информации
- Взаимодействие с рекомендациями
- Отслеживание статуса рекомендаций

## Интеграция

### Автоматическая генерация
- При создании анализа с отклонениями автоматически генерируются рекомендации
- Система анализирует результаты и применяет соответствующие правила

### Навигация
- Добавлены ссылки в главное меню
- Доступ только для авторизованных пользователей

## Безопасность

- Все API требуют авторизации
- Проверка прав доступа к данным пользователя
- Валидация входных данных
- Защита от SQL-инъекций через Prisma

## Масштабирование

### Возможности расширения
- Добавление новых типов рекомендаций
- Интеграция с внешними API партнеров
- Машинное обучение для улучшения рекомендаций
- Геолокационные рекомендации
- Система отзывов и рейтингов

### Производительность
- Пагинация для больших списков
- Кэширование популярных запросов
- Асинхронная генерация рекомендаций
- Индексы базы данных для быстрого поиска

## Мониторинг

- Логирование всех операций
- Отслеживание взаимодействий с рекомендациями
- Метрики эффективности рекомендаций
- Ошибки и исключения

## Заключение

Модуль маркетплейса обеспечивает персонализированный подход к рекомендациям медицинских услуг и товаров, основываясь на реальных данных о здоровье пользователя. Система автоматически анализирует анализы и предлагает релевантные решения от проверенных партнеров.
