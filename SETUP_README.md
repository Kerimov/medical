# Медицинский Ассистент - Инструкция по установке

## Описание проекта
Веб-приложение для управления медицинскими документами и анализами с использованием AI для распознавания и анализа медицинских данных.

## Системные требования
- Node.js 18+ 
- npm или yarn
- SQLite (встроен в проект)
- Git

## 1. Установка зависимостей

### Клонирование репозитория
```bash
git clone <repository-url>
cd medical-1
```

### Установка Node.js зависимостей
```bash
npm install
```

## 2. Настройка переменных окружения

Создайте файл `.env.local` в корне проекта:

```env
# JWT Secret для аутентификации
JWT_SECRET=your-super-secret-jwt-key-change-in-production

# OpenAI API Key для AI анализа
OPENAI_API_KEY=sk-proj-your-openai-api-key-here

# OCR.space API Key (опционально)
OCR_SPACE_API_KEY=your-ocr-space-api-key

# Админские email адреса (через запятую)
NEXT_PUBLIC_ADMIN_EMAILS=admin@example.com,admin2@example.com

# База данных (SQLite)
DATABASE_URL="file:./prisma/dev.db"
```

## 3. Настройка базы данных

### Генерация Prisma клиента
```bash
npx prisma generate
```

### Создание и применение миграций
```bash
npx prisma db push
```

### Заполнение тестовыми данными
```bash
node prisma/seed.js
```

Это создаст:
- Тестового пользователя: `seed@example.com` / `seed1234`
- Пример документа

## 4. Запуск проекта

### Режим разработки
```bash
npm run dev
```

Приложение будет доступно по адресу: `http://localhost:3000`

### Режим продакшн
```bash
npm run build
npm start
```

## 5. Структура проекта

```
medical-1/
├── app/                    # Next.js App Router
│   ├── api/               # API маршруты
│   │   ├── auth/          # Аутентификация
│   │   ├── analyses/      # Управление анализами
│   │   ├── documents/     # Управление документами
│   │   └── reminders/     # Управление напоминаниями
│   ├── dashboard/         # Главная панель
│   ├── analyses/          # Страницы анализов
│   ├── documents/         # Страницы документов
│   └── reminders/         # Страницы напоминаний
├── components/            # React компоненты
├── contexts/              # React контексты
├── lib/                   # Утилиты и библиотеки
├── prisma/                # Схема базы данных
└── public/                # Статические файлы
```

## 6. Основные функции

### Аутентификация
- Регистрация и вход пользователей
- JWT токены для авторизации
- Изоляция данных по пользователям

### Документы
- Загрузка PDF/изображений медицинских документов
- OCR распознавание текста (OCR.space + Tesseract.js)
- AI анализ медицинских данных (OpenAI GPT-4o-mini)

### Анализы
- Автоматическое создание записей анализов из документов
- Категоризация и группировка анализов
- Интеллектуальные комментарии AI

### Напоминания
- Автоматическое создание напоминаний на основе анализов
- Умные рекомендации (консультации врачей, прием лекарств)
- Поддержка различных каналов уведомлений (Email, Push, SMS)

## 7. API Endpoints

### Аутентификация
- `POST /api/auth/login` - Вход
- `POST /api/auth/register` - Регистрация
- `GET /api/auth/me` - Получение текущего пользователя

### Документы
- `GET /api/documents` - Список документов
- `POST /api/documents/upload` - Загрузка документа
- `GET /api/documents/[id]` - Детали документа

### Анализы
- `GET /api/analyses` - Список анализов
- `GET /api/analyses/[id]` - Детали анализа
- `POST /api/analyses/[id]/comments` - Генерация AI комментариев
- `POST /api/analyses/[id]/reminders` - Создание напоминаний

### Напоминания
- `GET /api/reminders` - Список напоминаний
- `POST /api/reminders` - Создание напоминания
- `PUT /api/reminders/[id]` - Обновление напоминания
- `DELETE /api/reminders/[id]` - Удаление напоминания

## 8. База данных

### Основные таблицы
- `User` - Пользователи
- `Document` - Загруженные документы
- `Analysis` - Результаты анализов
- `Reminder` - Напоминания
- `ReminderPreference` - Настройки уведомлений
- `ReminderDelivery` - История доставки уведомлений

### Просмотр базы данных
```bash
# Установка Prisma Studio (GUI для БД)
npx prisma studio
```

## 9. Возможные проблемы и решения

### Порт занят
```bash
# Остановка всех Node процессов
taskkill /f /im node.exe

# Очистка кэша Next.js
rm -rf .next
npm run dev
```

### Ошибки Prisma
```bash
# Перегенерация клиента
npx prisma generate

# Сброс базы данных
npx prisma db push --force-reset
node prisma/seed.js
```

### Проблемы с OCR
- Проверьте API ключ OCR.space
- Убедитесь, что OpenAI API ключ активен
- Проверьте лимиты API

## 10. Тестовые данные

### Пользователи
- **Админ**: `admin@example.com` / `admin123`
- **Тестовый**: `seed@example.com` / `seed1234`

### Тестовые документы
Загрузите любой PDF с медицинским анализом для тестирования OCR и AI функций.

## 11. Разработка

### Добавление новых функций
1. Создайте API маршрут в `app/api/`
2. Добавьте схему в `prisma/schema.prisma` при необходимости
3. Создайте компоненты в `components/`
4. Добавьте страницы в `app/`

### Линтинг и форматирование
```bash
npm run lint
npm run format
```

## 12. Безопасность

- Всегда меняйте `JWT_SECRET` в продакшене
- Не коммитьте `.env.local` файлы
- Используйте HTTPS в продакшене
- Ограничьте доступ к админским функциям

## 13. Мониторинг

### Логи
- Логи приложения: консоль сервера
- Логи базы данных: Prisma Studio
- Логи API: Network tab в DevTools

### Статус сервисов
- `GET /api/parser-status` - Статус AI парсера
- Проверка подключения к OpenAI API

## 14. Контакты

При возникновении проблем:
1. Проверьте логи в консоли браузера и сервера
2. Убедитесь, что все переменные окружения настроены
3. Проверьте статус внешних API (OpenAI, OCR.space)

---

**Примечание**: Этот проект использует SQLite для простоты разработки. В продакшене рекомендуется использовать PostgreSQL или MySQL.
