const { PrismaClient } = require('@prisma/client');

const prisma = new PrismaClient();

// Рекомендации для показателей - Часть 1 (Гематология, Биохимия)
const recommendationsPart1 = {
  "HCT": {
    maintenance: `**Для поддержания нормального гематокрита:**
• Достаточное потребление воды (1.5-2 литра в день)
• Сбалансированное питание с железом
• Регулярная физическая активность
• Избегать обезвоживания
• Контроль при высокогорье`,
    improvement: `**При низком гематокрите:**
• Лечить анемию (препараты железа, B12, фолаты)
• Увеличить потребление железосодержащих продуктов
• Обследоваться на кровопотери

**При высоком гематокрите:**
• Увеличить потребление жидкости до 2.5-3 литров
• Бросить курить
• Обследоваться у гематолога на полицитемию
• Рассмотреть кровопускания (при показаниях)`
  },

  "ESR": {
    maintenance: `**Для поддержания нормальной СОЭ:**
• Противовоспалительная диета
• Своевременное лечение инфекций
• Контроль хронических заболеваний
• Здоровый образ жизни
• Достаточный сон`,
    improvement: `**При повышенной СОЭ:**
• Выявить и лечить причину воспаления
• Противовоспалительная диета (омега-3, куркума)
• Лечить инфекционные заболевания
• Контролировать аутоиммунные заболевания
• При очень высоких значениях - обследование на онкологию
• Принимать НПВС по назначению врача`
  },

  "MCV": {
    maintenance: `**Для поддержания нормального MCV:**
• Достаточное потребление железа, B12, фолиевой кислоты
• Сбалансированное питание
• Ограничение алкоголя
• Контроль функции ЩЖ`,
    improvement: `**При низком MCV (микроцитоз):**
• Принимать препараты железа
• Обогатить рацион железом
• Лечить хронические кровопотери
• Исключить талассемию

**При высоком MCV (макроцитоз):**
• Принимать витамин B12 и фолиевую кислоту
• Ограничить или исключить алкоголь
• Обследовать функцию ЩЖ и печени
• Исключить мегалобластную анемию`
  },

  "MCH": {
    maintenance: `**Для поддержания нормального MCH:**
• Достаточное потребление железа и витаминов
• Сбалансированное питание
• Контроль анемий`,
    improvement: `**При низком MCH:**
• Принимать препараты железа
• Лечить железодефицитную анемию

**При высоком MCH:**
• Принимать B12 и фолаты
• Лечить мегалобластную анемию`
  },

  "MCHC": {
    maintenance: `**Для поддержания нормального MCHC:**
• Достаточное потребление железа
• Профилактика анемий
• Контроль гемолиза`,
    improvement: `**При низком MCHC:**
• Принимать препараты железа
• Лечить железодефицитную анемию
• Обследоваться на талассемию

**При высоком MCHC:**
• Обследоваться на наследственный сфероцитоз
• Контролировать гемолиз`
  },

  "RDW": {
    maintenance: `**Для поддержания нормального RDW:**
• Профилактика анемий
• Сбалансированное питание
• Достаточное потребление железа, B12, фолатов`,
    improvement: `**При повышенном RDW:**
• Лечить анемию (в зависимости от типа)
• Принимать недостающие витамины и минералы
• Обследоваться для выявления причины анизоцитоза`
  },

  "NEUT": {
    maintenance: `**Для поддержания нормального уровня нейтрофилов:**
• Здоровый образ жизни
• Своевременное лечение инфекций
• Избегать контактов с инфекционными больными
• Укрепление иммунитета`,
    improvement: `**При низких нейтрофилах:**
• Избегать контактов с больными
• Соблюдать гигиену
• Принимать колониестимулирующие факторы (по назначению)
• Лечить основное заболевание

**При высоких нейтрофилах:**
• Лечить бактериальную инфекцию
• Контролировать воспалительные процессы
• Обследоваться у гематолога (при стойком повышении)`
  },

  "LYMPH": {
    maintenance: `**Для поддержания нормального уровня лимфоцитов:**
• Здоровый образ жизни
• Достаточный сон
• Избегать стрессов
• Сбалансированное питание
• Витамины C, D, цинк`,
    improvement: `**При низких лимфоцитах:**
• Укреплять иммунитет (витамины, адаптогены)
• Избегать контактов с больными
• Лечить основное заболевание
• Обследоваться на иммунодефицит

**При высоких лимфоцитах:**
• Лечить вирусную инфекцию
• Обследоваться у гематолога (при стойком повышении)
• Исключить лимфопролиферативные заболевания`
  },

  "MONO": {
    maintenance: `**Для поддержания нормального уровня моноцитов:**
• Здоровый образ жизни
• Своевременное лечение инфекций
• Контроль хронических заболеваний`,
    improvement: `**При повышенных моноцитах:**
• Лечить хроническую инфекцию
• Обследоваться на туберкулез (при показаниях)
• Контролировать аутоиммунные заболевания
• При стойком повышении - консультация гематолога`
  },

  "EOS": {
    maintenance: `**Для поддержания нормального уровня эозинофилов:**
• Контроль аллергий
• Профилактика паразитозов
• Гигиена питания`,
    improvement: `**При повышенных эозинофилах:**
• Выявить и устранить аллерген
• Принимать антигистаминные препараты
• Обследоваться на паразитозы (анализ кала на яйца глист)
• Лечить бронхиальную астму (при наличии)
• Контролировать эозинофильные заболевания`
  },

  "BASO": {
    maintenance: `**Для поддержания нормального уровня базофилов:**
• Контроль аллергий
• Здоровый образ жизни
• Избегать стрессов`,
    improvement: `**При повышенных базофилах:**
• Лечить аллергические заболевания
• Обследоваться у гематолога (при значительном повышении)
• Исключить хронический миелолейкоз`
  },

  "HBA1C": {
    maintenance: `**Для поддержания нормального HbA1c:**
• Контроль углеводов в питании
• Регулярные физические нагрузки
• Поддержание нормального веса
• Контроль глюкозы натощак
• Здоровый образ жизни`,
    improvement: `**При повышенном HbA1c:**
• Строгий контроль углеводов (подсчет ХЕ)
• Увеличить физическую активность (150-300 мин/неделю)
• Снизить вес на 5-10%
• Принимать сахароснижающие препараты по схеме
• Регулярный самоконтроль глюкозы
• Обучение в школе диабета
• Контроль HbA1c каждые 3 месяца
• Целевой HbA1c <7% (индивидуально)`
  },

  "UA_ACID": {
    maintenance: `**Для поддержания нормального уровня мочевой кислоты:**
• Ограничение пуринов (субпродукты, красное мясо, морепродукты)
• Ограничение алкоголя, особенно пива
• Достаточное потребление воды
• Поддержание нормального веса
• Ограничение фруктозы`,
    improvement: `**При повышенной мочевой кислоте:**
• Строго ограничить пурины (печень, почки, анчоусы, сардины)
• Исключить алкоголь
• Увеличить потребление воды до 2.5-3 литров
• Снизить вес постепенно (резкое похудение повышает МК)
• Ограничить фруктозу
• Принимать аллопуринол или фебуксостат по назначению
• Контролировать функцию почек
• Профилактика приступов подагры`
  },

  "GGT": {
    maintenance: `**Для поддержания нормального уровня ГГТ:**
• Ограничение алкоголя
• Здоровое питание
• Поддержание нормального веса
• Избегать гепатотоксичных препаратов`,
    improvement: `**При повышенном ГГТ:**
• Полностью исключить алкоголь
• Снизить вес при ожирении
• Диета с низким содержанием жиров
• Отменить гепатотоксичные препараты
• Принимать гепатопротекторы
• Обследоваться на заболевания печени и желчевыводящих путей
• Контроль ГГТ через 1-3 месяца`
  },

  "ALP": {
    maintenance: `**Для поддержания нормального уровня ЩФ:**
• Достаточное потребление кальция и витамина D
• Регулярная физическая активность
• Здоровье печени и желчевыводящих путей`,
    improvement: `**При повышенной ЩФ:**
• Обследоваться для выявления причины (печень или кости)
• При холестазе - лечить заболевания желчевыводящих путей
• При костных заболеваниях - принимать кальций и витамин D
• Лечить остеопороз (бисфосфонаты по назначению)
• Контролировать функцию печени`
  },

  "TBIL": {
    maintenance: `**Для поддержания нормального уровня билирубина:**
• Здоровье печени (ограничение алкоголя, жиров)
• Профилактика гепатитов (вакцинация)
• Достаточное потребление воды
• Избегать гепатотоксичных препаратов`,
    improvement: `**При повышенном билирубине:**
• Выявить причину (гемолиз, печень, желчевыводящие пути)
• При гемолизе - лечить основное заболевание
• При гепатите - противовирусная терапия
• При холестазе - лечить заболевания желчевыводящих путей
• Принимать гепатопротекторы
• Фототерапия (при синдроме Жильбера)
• Обильное питье`
  },

  "DBIL": {
    maintenance: `**Для поддержания нормального прямого билирубина:**
• Здоровье печени и желчевыводящих путей
• Профилактика холестаза
• Достаточное потребление воды`,
    improvement: `**При повышенном прямом билирубине:**
• Обследовать желчевыводящие пути (УЗИ, МРХПГ)
• Лечить холестаз
• Удалить камни желчного пузыря (при наличии)
• Принимать урсодезоксихолевую кислоту
• Лечить гепатит
• При механической желтухе - хирургическое лечение`
  },

  "TP": {
    maintenance: `**Для поддержания нормального общего белка:**
• Достаточное потребление белка (1-1.2 г/кг веса)
• Сбалансированное питание
• Здоровье печени и почек
• Достаточное потребление воды`,
    improvement: `**При низком общем белке:**
• Увеличить потребление белка (мясо, рыба, яйца, бобовые)
• Лечить заболевания печени
• Лечить заболевания почек (при протеинурии)
• Лечить мальабсорбцию (при наличии)
• Принимать аминокислотные смеси (при показаниях)

**При высоком общем белке:**
• Увеличить потребление воды
• Лечить воспалительные заболевания
• Обследоваться на парапротеинемии`
  },

  "ALB": {
    maintenance: `**Для поддержания нормального альбумина:**
• Достаточное потребление белка
• Здоровье печени
• Контроль функции почек
• Сбалансированное питание`,
    improvement: `**При низком альбумине:**
• Увеличить потребление белка до 1.2-1.5 г/кг
• Лечить заболевания печени
• Контролировать протеинурию
• Лечить воспалительные заболевания
• Принимать альбумин внутривенно (при критических значениях)
• Обследоваться на мальабсорбцию`
  },

  "PCT": {
    maintenance: `**Для поддержания низкого прокальцитонина:**
• Профилактика бактериальных инфекций
• Своевременное лечение инфекций
• Укрепление иммунитета
• Гигиена`,
    improvement: `**При повышенном прокальцитонине:**
• Срочная антибиотикотерапия (при сепсисе)
• Госпитализация при высоких значениях
• Поиск источника инфекции
• Интенсивная терапия при сепсисе
• Контроль прокальцитонина в динамике`
  },

  "FE": {
    maintenance: `**Для поддержания нормального железа:**
• Достаточное потребление железа с пищей
• Витамин C для лучшего усвоения
• Контроль кровопотерь
• Профилактика анемии`,
    improvement: `**При низком железе:**
• Принимать препараты железа (100-200 мг/день)
• Увеличить железо в рационе
• Добавить витамин C
• Лечить источники кровопотери
• Контроль через 2-3 месяца

**При высоком железе:**
• Ограничить железосодержащие продукты
• Регулярное донорство крови
• Обследоваться на гемохроматоз
• Избегать витамина C в больших дозах`
  },

  "TIBC": {
    maintenance: `**Для поддержания нормальной ОЖСС:**
• Сбалансированное питание
• Контроль запасов железа
• Профилактика анемии`,
    improvement: `**При повышенной ОЖСС:**
• Принимать препараты железа
• Лечить железодефицитную анемию

**При пониженной ОЖСС:**
• Лечить воспалительные заболевания
• Контролировать запасы железа`
  },

  "TRANS": {
    maintenance: `**Для поддержания нормального трансферрина:**
• Достаточное потребление железа
• Здоровье печени
• Сбалансированное питание`,
    improvement: `**При низком трансферрине:**
• Лечить заболевания печени
• Контролировать воспаление
• Улучшить питание

**При высоком трансферрине:**
• Принимать препараты железа
• Лечить железодефицитную анемию`
  },

  "TROP_I": {
    maintenance: `**Для профилактики повышения тропонина:**
• Контроль факторов риска ССЗ
• Здоровое питание
• Регулярные физические нагрузки
• Контроль АД, холестерина, глюкозы
• Отказ от курения`,
    improvement: `**При повышенном тропонине:**
• СРОЧНАЯ ГОСПИТАЛИЗАЦИЯ (подозрение на инфаркт!)
• ЭКГ и консультация кардиолога немедленно
• Антитромботическая терапия
• Реваскуляризация (при показаниях)
• Реабилитация после инфаркта
• Вторичная профилактика (статины, антиагреганты)`
  },

  "CPK": {
    maintenance: `**Для поддержания нормального КФК:**
• Умеренные физические нагрузки
• Избегать чрезмерных нагрузок
• Профилактика травм
• Здоровье сердца и мышц`,
    improvement: `**При повышенном КФК:**
• При подозрении на инфаркт - срочная госпитализация
• Снизить интенсивность физических нагрузок
• Лечить миопатии (при наличии)
• Исключить рабдомиолиз
• Контролировать функцию почек
• Отменить статины (если они причина)`
  },

  "LDH": {
    maintenance: `**Для поддержания нормального ЛДГ:**
• Здоровый образ жизни
• Профилактика повреждения тканей
• Контроль хронических заболеваний`,
    improvement: `**При повышенном ЛДГ:**
• Выявить источник повреждения тканей
• Лечить основное заболевание
• При инфаркте - кардиологическая помощь
• При гемолизе - лечить причину
• При опухолях - онкологическое лечение`
  },

  "NTPROBNP": {
    maintenance: `**Для профилактики сердечной недостаточности:**
• Контроль АД (<130/80)
• Здоровое питание с ограничением соли
• Регулярные физические нагрузки
• Поддержание нормального веса
• Отказ от курения
• Контроль диабета и холестерина`,
    improvement: `**При повышенном NT-proBNP:**
• Строгое ограничение соли (<3 г/день)
• Ограничение жидкости (при отеках)
• Принимать диуретики по назначению
• Принимать иАПФ/БРА, бета-блокаторы
• Контроль веса ежедневно
• Умеренная физическая активность (кардиореабилитация)
• Лечить основное заболевание сердца
• Регулярное наблюдение кардиолога`
  },

  "NA": {
    maintenance: `**Для поддержания нормального натрия:**
• Сбалансированное потребление соли (5-6 г/день)
• Достаточное потребление воды
• Избегать обезвоживания`,
    improvement: `**При низком натрии:**
• Ограничить потребление воды (при гипонатриемии разведения)
• Увеличить потребление соли (при потерях)
• Лечить основное заболевание
• При тяжелой гипонатриемии - госпитализация

**При высоком натрии:**
• Увеличить потребление воды
• Ограничить соль
• Лечить обезвоживание
• Контролировать диурез`
  },

  "K": {
    maintenance: `**Для поддержания нормального калия:**
• Достаточное потребление калия (бананы, картофель, сухофрукты)
• Контроль функции почек
• Осторожность с диуретиками`,
    improvement: `**При низком калии:**
• Увеличить потребление калия (бананы, курага, картофель)
• Принимать препараты калия
• Отменить или скорректировать диуретики
• Лечить причину потерь (рвота, диарея)
• При критических значениях - внутривенное введение

**При высоком калии:**
• Ограничить калий в питании
• Отменить калийсберегающие диуретики
• Лечить почечную недостаточность
• При критических значениях - срочная госпитализация
• Гемодиализ (при показаниях)`
  },

  "CL": {
    maintenance: `**Для поддержания нормального хлора:**
• Сбалансированное питание
• Достаточное потребление воды
• Контроль кислотно-основного состояния`,
    improvement: `**При отклонениях хлора:**
• Лечить основное заболевание
• Корректировать водно-электролитный баланс
• Контролировать кислотно-основное состояние`
  },

  "CA": {
    maintenance: `**Для поддержания нормального кальция:**
• Достаточное потребление кальция (1000-1200 мг/день)
• Витамин D (800-1000 МЕ/день)
• Регулярная физическая активность
• Умеренное пребывание на солнце
• Ограничение кофеина`,
    improvement: `**При низком кальции:**
• Увеличить потребление кальция (молочные продукты, сыр)
• Принимать препараты кальция (1000-1500 мг/день)
• Добавить витамин D (2000-4000 МЕ/день)
• Обследовать паращитовидные железы
• Контролировать уровень магния и фосфора

**При высоком кальции:**
• Увеличить потребление воды
• Ограничить кальций и витамин D
• Обследоваться на гиперпаратиреоз
• Лечить основное заболевание
• При критических значениях - госпитализация`
  },

  "MG": {
    maintenance: `**Для поддержания нормального магния:**
• Достаточное потребление магния (орехи, семена, зеленые овощи)
• Ограничение алкоголя
• Контроль диуретиков`,
    improvement: `**При низком магнии:**
• Увеличить потребление магния (орехи, семена, бананы)
• Принимать препараты магния (300-400 мг/день)
• Ограничить алкоголь
• Скорректировать диуретики
• Лечить диарею (если есть)

**При высоком магнии:**
• Ограничить магний в питании
• Отменить препараты магния
• Лечить почечную недостаточность
• При критических значениях - гемодиализ`
  },

  "P": {
    maintenance: `**Для поддержания нормального фосфора:**
• Сбалансированное питание
• Контроль функции почек
• Достаточное потребление витамина D`,
    improvement: `**При низком фосфоре:**
• Увеличить потребление фосфора (молочные продукты, рыба)
• Принимать препараты фосфора
• Добавить витамин D
• Лечить рахит (у детей)

**При высоком фосфоре:**
• Ограничить фосфор в питании
• Принимать фосфат-биндеры (при ХБП)
• Контролировать функцию почек
• Лечить почечную недостаточность`
  },

  "AMY": {
    maintenance: `**Для поддержания нормальной амилазы:**
• Умеренное питание без переедания
• Ограничение алкоголя
• Избегать жирной и жареной пищи
• Контроль веса`,
    improvement: `**При повышенной амилазе:**
• При остром панкреатите - срочная госпитализация
• Голод в первые дни обострения
• Диета №5п (протертая, нежирная)
• Ферментные препараты
• Обезболивание
• Лечить хронический панкреатит
• Исключить камни желчного пузыря
• Полный отказ от алкоголя`
  },

  "LIP": {
    maintenance: `**Для поддержания нормальной липазы:**
• Здоровое питание
• Ограничение алкоголя
• Избегать жирной пищи
• Контроль веса`,
    improvement: `**При повышенной липазе:**
• При остром панкреатите - госпитализация
• Голод 1-3 дня
• Диета №5п после обострения
• Ферментные препараты
• Лечить хронический панкреатит
• Полный отказ от алкоголя
• Исключить камни желчного пузыря`
  }
};

async function main() {
  console.log('📝 Добавление рекомендаций (Часть 1)...');

  try {
    let updated = 0;

    for (const [code, rec] of Object.entries(recommendationsPart1)) {
      const indicator = await prisma.indicator.findFirst({
        where: { code: code }
      });

      if (indicator) {
        await prisma.indicator.update({
          where: { id: indicator.id },
          data: {
            maintenanceRecommendations: rec.maintenance,
            improvementRecommendations: rec.improvement
          }
        });
        updated++;
        console.log(`✅ ${indicator.name} (${code})`);
      }
    }

    console.log(`\n🎉 Часть 1 завершена!`);
    console.log(`📊 Обновлено показателей: ${updated}`);

  } catch (error) {
    console.error('❌ Ошибка:', error);
    throw error;
  }
}

main()
  .catch((e) => {
    console.error('❌ Критическая ошибка:', e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });
