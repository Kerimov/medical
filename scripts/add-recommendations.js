const { PrismaClient } = require('@prisma/client');

const prisma = new PrismaClient();

// Рекомендации для каждого показателя
const recommendations = {
  // Гематология
  "HGB": {
    maintenance: `**Для поддержания нормального уровня гемоглобина:**
• Сбалансированное питание с достаточным содержанием железа (красное мясо, печень, бобовые, гречка)
• Употребление продуктов, богатых витамином C (улучшает усвоение железа)
• Регулярные физические нагрузки умеренной интенсивности
• Достаточный сон (7-8 часов)
• Избегать чрезмерного употребления чая и кофе во время еды (снижают усвоение железа)
• Регулярные профилактические осмотры`,
    improvement: `**При пониженном гемоглобине:**
• Увеличить потребление железосодержащих продуктов (говядина, печень, яйца, гранаты)
• Принимать препараты железа по назначению врача
• Добавить витамин B12 и фолиевую кислоту
• Лечить основное заболевание (при наличии)
• Избегать донорства крови до нормализации показателей

**При повышенном гемоглобине:**
• Увеличить потребление жидкости
• Ограничить курение
• Обратиться к гематологу для исключения полицитемии
• Контролировать артериальное давление
• Избегать высокогорья и гипоксии`
  },

  "RBC": {
    maintenance: `**Для поддержания нормального количества эритроцитов:**
• Полноценное питание с достаточным содержанием белка и железа
• Регулярная физическая активность
• Достаточное потребление воды (1.5-2 литра в день)
• Избегать стрессов и переутомления
• Регулярный сон
• Профилактика анемии`,
    improvement: `**При низком уровне эритроцитов:**
• Обогатить рацион железом, витамином B12, фолиевой кислотой
• Лечить хронические кровопотери (если есть)
• Принимать витаминно-минеральные комплексы
• Обследоваться на скрытые кровотечения

**При высоком уровне:**
• Увеличить потребление жидкости
• Бросить курить
• Обследоваться у гематолога
• Контролировать уровень кислорода в крови`
  },

  "WBC": {
    maintenance: `**Для поддержания нормального уровня лейкоцитов:**
• Здоровый образ жизни и сбалансированное питание
• Достаточный сон и отдых
• Умеренные физические нагрузки
• Избегать стрессов
• Своевременное лечение инфекций
• Укрепление иммунитета (витамины C, D, цинк)`,
    improvement: `**При низком уровне лейкоцитов:**
• Обогатить рацион белком, витаминами группы B
• Избегать контактов с инфекционными больными
• Принимать иммуномодуляторы по назначению врача
• Лечить основное заболевание

**При высоком уровне:**
• Обследоваться для выявления причины (инфекция, воспаление)
• Лечить инфекционные заболевания
• Контролировать хронические воспалительные процессы
• При необходимости - консультация гематолога`
  },

  "PLT": {
    maintenance: `**Для поддержания нормального уровня тромбоцитов:**
• Сбалансированное питание с достаточным содержанием витаминов K, B12
• Избегать приема препаратов, влияющих на тромбоциты (аспирин без назначения)
• Умеренная физическая активность
• Достаточное потребление жидкости
• Избегать травм и кровотечений`,
    improvement: `**При низком уровне тромбоцитов:**
• Обогатить рацион витамином K (зеленые овощи, капуста)
• Избегать травм и контактных видов спорта
• Отменить препараты, снижающие тромбоциты (по согласованию с врачом)
• Обследоваться у гематолога
• При необходимости - переливание тромбоцитарной массы

**При высоком уровне:**
• Увеличить потребление жидкости
• Принимать антиагреганты по назначению врача
• Обследоваться для исключения миелопролиферативных заболеваний
• Контролировать показатели свертывания`
  },

  "GLU": {
    maintenance: `**Для поддержания нормального уровня глюкозы:**
• Сбалансированное питание с ограничением простых углеводов
• Регулярные физические нагрузки (150 минут в неделю)
• Поддержание нормального веса (ИМТ 18.5-24.9)
• Достаточный сон (7-8 часов)
• Контроль стресса
• Ограничение алкоголя
• Регулярный контроль глюкозы (1 раз в год)`,
    improvement: `**При повышенной глюкозе:**
• Снизить потребление сахара и простых углеводов
• Увеличить физическую активность (ходьба 30-60 минут ежедневно)
• Снизить вес при избыточной массе тела
• Увеличить потребление клетчатки (овощи, цельнозерновые)
• Контролировать размер порций
• Принимать сахароснижающие препараты по назначению врача
• Регулярный самоконтроль глюкозы

**При пониженной глюкозе:**
• Регулярное питание 5-6 раз в день малыми порциями
• Носить с собой быстрые углеводы (сок, конфеты)
• Избегать пропусков приемов пищи
• Скорректировать дозы инсулина (при диабете)
• Обследоваться для исключения инсулиномы`
  },

  "CHOL": {
    maintenance: `**Для поддержания нормального уровня холестерина:**
• Средиземноморская диета (рыба, оливковое масло, овощи, фрукты)
• Ограничение насыщенных жиров (жирное мясо, сливочное масло)
• Регулярные аэробные нагрузки (бег, плавание, велосипед)
• Поддержание нормального веса
• Отказ от курения
• Ограничение алкоголя
• Контроль холестерина 1 раз в год`,
    improvement: `**При повышенном холестерине:**
• Исключить трансжиры и ограничить насыщенные жиры
• Увеличить потребление омега-3 (жирная рыба, льняное масло)
• Добавить растворимую клетчатку (овсянка, яблоки, бобовые)
• Увеличить физическую активность до 300 минут в неделю
• Снизить вес при избыточной массе тела
• Принимать статины по назначению врача
• Добавить растительные стеролы
• Ограничить яйца и субпродукты

**При пониженном холестерине:**
• Увеличить калорийность питания
• Добавить здоровые жиры (орехи, авокадо, рыба)
• Обследовать функцию печени и щитовидной железы
• Исключить мальабсорбцию`
  },

  "LDL": {
    maintenance: `**Для поддержания нормального уровня ЛПНП:**
• Диета с низким содержанием насыщенных жиров
• Регулярные кардионагрузки
• Поддержание нормального веса
• Отказ от курения
• Контроль артериального давления
• Употребление продуктов с растительными стеролами`,
    improvement: `**При повышенном ЛПНП:**
• Строгое ограничение насыщенных жиров (<7% калорий)
• Исключить трансжиры полностью
• Увеличить потребление растворимой клетчатки (10-25 г/день)
• Добавить омега-3 жирные кислоты (рыба 2-3 раза в неделю)
• Снизить вес на 5-10% при избыточной массе
• Физические нагрузки 30-60 минут ежедневно
• Принимать статины по назначению врача
• Добавить растительные стеролы (2 г/день)
• Ограничить холестерин пищи (<200 мг/день)`
  },

  "HDL": {
    maintenance: `**Для поддержания нормального уровня ЛПВП:**
• Регулярные аэробные упражнения (повышают ЛПВП)
• Поддержание нормального веса
• Отказ от курения
• Умеренное потребление алкоголя (по согласованию с врачом)
• Здоровое питание с омега-3
• Избегать трансжиров`,
    improvement: `**При низком ЛПВП:**
• Увеличить аэробные нагрузки (бег, плавание, велосипед) - 150-300 мин/неделю
• Снизить вес при избыточной массе тела
• Бросить курить (курение снижает ЛПВП на 10-15%)
• Добавить омега-3 жирные кислоты
• Ограничить простые углеводы
• Добавить мононенасыщенные жиры (оливковое масло, авокадо)
• Рассмотреть прием ниацина (по назначению врача)
• Контролировать уровень триглицеридов`
  },

  "TG": {
    maintenance: `**Для поддержания нормального уровня триглицеридов:**
• Ограничение простых углеводов и сахара
• Умеренное потребление алкоголя
• Регулярные физические нагрузки
• Поддержание нормального веса
• Достаточное потребление омега-3`,
    improvement: `**При повышенных триглицеридах:**
• Строго ограничить сахар и простые углеводы
• Исключить или минимизировать алкоголь
• Снизить вес на 5-10% при избыточной массе
• Увеличить физическую активность
• Добавить омега-3 жирные кислоты (2-4 г/день)
• Ограничить фруктозу
• Увеличить потребление клетчатки
• Принимать фибраты или омега-3 препараты по назначению врача
• Контролировать уровень глюкозы (часто сочетается с диабетом)`
  },

  "CREA": {
    maintenance: `**Для поддержания нормального уровня креатинина:**
• Достаточное потребление воды (1.5-2 литра в день)
• Умеренное потребление белка (0.8-1 г/кг веса)
• Контроль артериального давления
• Избегать нефротоксичных препаратов
• Ограничение соли
• Регулярная физическая активность`,
    improvement: `**При повышенном креатинине:**
• Увеличить потребление воды до 2-2.5 литров в день
• Ограничить белок до 0.6-0.8 г/кг веса
• Строго контролировать артериальное давление (<130/80)
• Ограничить соль до 5 г/день
• Избегать НПВС и других нефротоксичных препаратов
• Контролировать уровень глюкозы при диабете
• Обследоваться у нефролога
• Рассмотреть нефропротективную терапию (иАПФ, БРА)

**При пониженном креатинине:**
• Увеличить физическую активность
• Обогатить рацион белком
• Исключить заболевания мышц`
  },

  "UREA": {
    maintenance: `**Для поддержания нормального уровня мочевины:**
• Сбалансированное питание с умеренным содержанием белка
• Достаточное потребление воды
• Контроль функции почек
• Избегать обезвоживания
• Ограничение соли`,
    improvement: `**При повышенной мочевине:**
• Увеличить потребление воды
• Ограничить белок в рационе
• Контролировать функцию почек
• Лечить основное заболевание почек
• Избегать обезвоживания

**При пониженной мочевине:**
• Увеличить потребление белка
• Обследовать функцию печени
• Исключить мальабсорбцию`
  },

  "AST": {
    maintenance: `**Для поддержания нормального уровня АСТ:**
• Ограничение алкоголя
• Здоровое питание с ограничением жиров
• Поддержание нормального веса
• Избегать гепатотоксичных препаратов
• Вакцинация против гепатитов A и B
• Регулярная физическая активность`,
    improvement: `**При повышенном АСТ:**
• Полностью исключить алкоголь
• Диета с ограничением жиров (при жировом гепатозе)
• Снизить вес при избыточной массе тела
• Отменить гепатотоксичные препараты
• Принимать гепатопротекторы по назначению врача
• Обследоваться для выявления причины (гепатит, цирроз, инфаркт)
• При инфаркте миокарда - неотложная кардиологическая помощь
• Лечить вирусные гепатиты (при наличии)`
  },

  "ALT": {
    maintenance: `**Для поддержания нормального уровня АЛТ:**
• Ограничение алкоголя
• Здоровое питание без избытка жиров
• Поддержание нормального веса
• Избегать гепатотоксичных лекарств
• Вакцинация против гепатитов
• Контроль метаболического синдрома`,
    improvement: `**При повышенном АЛТ:**
• Полностью исключить алкоголь
• Снизить вес при ожирении (целевое снижение 7-10%)
• Диета с низким содержанием жиров и простых углеводов
• Увеличить физическую активность
• Отменить гепатотоксичные препараты
• Принимать гепатопротекторы (урсодезоксихолевая кислота, силимарин)
• Лечить вирусные гепатиты (интерферон, противовирусные)
• Контролировать уровень глюкозы и липидов
• Обследоваться на жировой гепатоз, гепатит, цирроз`
  },

  "TSH": {
    maintenance: `**Для поддержания нормального уровня ТТГ:**
• Достаточное потребление йода (йодированная соль, морепродукты)
• Сбалансированное питание с селеном
• Избегать стрессов
• Достаточный сон
• Регулярный контроль функции щитовидной железы
• Избегать избытка сои (может влиять на функцию ЩЖ)`,
    improvement: `**При повышенном ТТГ (гипотиреоз):**
• Принимать левотироксин по назначению эндокринолога
• Обеспечить достаточное потребление йода
• Добавить селен (100-200 мкг/день)
• Избегать продуктов, подавляющих функцию ЩЖ (сырая капуста, соя в больших количествах)
• Регулярный контроль ТТГ и коррекция дозы препарата
• Лечить аутоиммунный тиреоидит (при наличии)

**При пониженном ТТГ (гипертиреоз):**
• Обследоваться у эндокринолога
• Принимать тиреостатики по назначению
• Ограничить йод в питании
• Избегать стрессов
• Рассмотреть радиойодтерапию или операцию (при показаниях)
• Контролировать сердечный ритм`
  },

  "FT4": {
    maintenance: `**Для поддержания нормального уровня Т4:**
• Достаточное потребление йода
• Сбалансированное питание
• Контроль функции щитовидной железы
• Избегать стрессов
• Достаточный сон`,
    improvement: `**При пониженном Т4:**
• Принимать левотироксин по назначению врача
• Обеспечить достаточное потребление йода
• Регулярный контроль и коррекция дозы
• Принимать препарат утром натощак

**При повышенном Т4:**
• Принимать тиреостатики по назначению
• Ограничить йод
• Контролировать сердечный ритм
• Рассмотреть радиойодтерапию`
  },

  "CRP": {
    maintenance: `**Для поддержания низкого уровня СРБ:**
• Противовоспалительная диета (омега-3, куркума, имбирь)
• Регулярные физические нагрузки
• Поддержание нормального веса
• Достаточный сон
• Контроль стресса
• Отказ от курения
• Здоровье полости рта (лечение кариеса, пародонтоза)`,
    improvement: `**При повышенном СРБ:**
• Выявить и лечить источник воспаления
• Противовоспалительная диета (жирная рыба, ягоды, зеленые овощи)
• Снизить вес при ожирении
• Увеличить физическую активность
• Принимать омега-3 (2-4 г/день)
• Добавить куркумин
• Лечить хронические инфекции
• Контролировать хронические заболевания (диабет, гипертония)
• При очень высоких значениях - обследование на аутоиммунные заболевания`
  },

  "FERR": {
    maintenance: `**Для поддержания нормального уровня ферритина:**
• Сбалансированное питание с достаточным железом
• Регулярное донорство крови (для мужчин - помогает избежать избытка)
• Контроль менструальной кровопотери у женщин
• Достаточное потребление витамина C`,
    improvement: `**При низком ферритине:**
• Увеличить потребление железа (красное мясо, печень, гранаты)
• Принимать препараты железа (100-200 мг элементарного железа в день)
• Добавить витамин C для лучшего усвоения
• Лечить источники кровопотери (обильные менструации, язвы)
• Избегать чая и кофе во время еды
• Контроль ферритина через 3 месяца

**При высоком ферритине:**
• Регулярное донорство крови (флеботомия)
• Ограничить железосодержащие продукты
• Исключить алкоголь
• Обследоваться на гемохроматоз
• Лечить воспалительные заболевания
• Контролировать функцию печени`
  },

  "PTI": {
    maintenance: `**Для поддержания нормального ПТИ:**
• Сбалансированное питание с витамином K
• Избегать самолечения антикоагулянтами
• Контроль при приеме варфарина
• Достаточное потребление зеленых овощей`,
    improvement: `**При низком ПТИ (риск кровотечений):**
• Увеличить потребление витамина K (зеленые овощи, капуста)
• Скорректировать дозу антикоагулянтов
• Избегать травм
• Обследовать функцию печени
• Исключить дефицит витамина K

**При высоком ПТИ (риск тромбозов):**
• Принимать антикоагулянты по назначению
• Увеличить физическую активность
• Достаточное потребление воды
• Избегать длительной иммобилизации`
  },

  "INR": {
    maintenance: `**Для поддержания целевого МНО (при приеме варфарина):**
• Стабильное потребление витамина K (не исключать, но поддерживать постоянный уровень)
• Регулярный контроль МНО
• Избегать взаимодействующих препаратов
• Информировать всех врачей о приеме антикоагулянтов`,
    improvement: `**При низком МНО (недостаточная антикоагуляция):**
• Увеличить дозу варфарина по назначению врача
• Проверить комплаентность (регулярность приема)
• Исключить взаимодействие с другими препаратами
• Ограничить продукты с высоким содержанием витамина K

**При высоком МНО (риск кровотечений):**
• Снизить дозу варфарина
• При МНО >5 - прием витамина K
• Избегать травм
• Исключить кровотечения
• Проверить функцию печени
• Частый контроль МНО до стабилизации`
  },

  "PROT_U": {
    maintenance: `**Для предотвращения протеинурии:**
• Контроль артериального давления (<130/80)
• Контроль уровня глюкозы при диабете
• Достаточное потребление воды
• Ограничение соли
• Избегать нефротоксичных препаратов`,
    improvement: `**При протеинурии:**
• Строгий контроль АД (<125/75 при протеинурии)
• Ограничение белка до 0.6-0.8 г/кг веса
• Ограничение соли до 3-5 г/день
• Принимать иАПФ или БРА по назначению
• Контролировать уровень глюкозы при диабете
• Обследоваться у нефролога
• Контроль протеинурии каждые 3 месяца
• Лечить основное заболевание почек`
  },

  "LEU_U": {
    maintenance: `**Для предотвращения лейкоцитурии:**
• Достаточное потребление воды (2 литра в день)
• Гигиена мочеполовых органов
• Своевременное опорожнение мочевого пузыря
• Избегать переохлаждения
• Клюквенный сок (профилактика ИМП)`,
    improvement: `**При лейкоцитурии:**
• Обильное питье (2.5-3 литра в день)
• Клюквенный сок или экстракт
• Антибиотикотерапия по назначению врача
• Уросептики растительные (канефрон, фитолизин)
• Избегать переохлаждения
• Соблюдать гигиену
• Контрольный анализ мочи после лечения
• При рецидивах - обследование у уролога`
  }
};

async function main() {
  console.log('📝 Добавление рекомендаций к показателям...');

  try {
    const indicators = await prisma.indicator.findMany();
    console.log(`📊 Найдено показателей: ${indicators.length}`);

    let updated = 0;
    let skipped = 0;

    for (const indicator of indicators) {
      const rec = recommendations[indicator.code];
      
      if (rec) {
        await prisma.indicator.update({
          where: { id: indicator.id },
          data: {
            maintenanceRecommendations: rec.maintenance,
            improvementRecommendations: rec.improvement
          }
        });
        updated++;
        console.log(`✅ ${indicator.name} (${indicator.code})`);
      } else {
        skipped++;
      }
    }

    console.log(`\n🎉 Рекомендации добавлены!`);
    console.log(`📊 Статистика:`);
    console.log(`   ✅ Обновлено: ${updated}`);
    console.log(`   ⚠️ Пропущено (нет рекомендаций): ${skipped}`);

  } catch (error) {
    console.error('❌ Ошибка:', error);
    throw error;
  }
}

main()
  .catch((e) => {
    console.error('❌ Критическая ошибка:', e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });
