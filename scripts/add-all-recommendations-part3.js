const { PrismaClient } = require('@prisma/client');

const prisma = new PrismaClient();

// Рекомендации для показателей - Часть 3 (Онкомаркеры, Серология, Микроэлементы, Посев)
const recommendationsPart3 = {
  "PSA": {
    maintenance: `**Для поддержания нормального ПСА:**
• Здоровье простаты
• Регулярные обследования после 50 лет
• Здоровое питание (томаты, зеленый чай)
• Регулярная половая жизнь
• Избегать застоя в малом тазу`,
    improvement: `**При повышенном ПСА:**
• Обследоваться у уролога
• МРТ простаты
• Биопсия простаты (при показаниях)
• Лечить простатит (при наличии)
• Лечить ДГПЖ (альфа-блокаторы, ингибиторы 5-альфа-редуктазы)
• При раке простаты - онкологическое лечение
• Контроль ПСА каждые 3-6 месяцев`
  },

  "CA125": {
    maintenance: `**Для профилактики повышения СА 125:**
• Регулярные гинекологические осмотры
• Контроль эндометриоза
• Здоровый образ жизни`,
    improvement: `**При повышенном СА 125:**
• Обследоваться у гинеколога
• УЗИ органов малого таза
• При подозрении на рак - КТ, МРТ
• Лечить эндометриоз
• При раке яичников - онкологическое лечение
• Контроль СА 125 в динамике`
  },

  "CA153": {
    maintenance: `**Для профилактики рака молочной железы:**
• Регулярная самопроверка груди
• Маммография после 40 лет (ежегодно)
• Поддержание нормального веса
• Ограничение алкоголя
• Грудное вскармливание`,
    improvement: `**При повышенном СА 15-3:**
• Обследоваться у маммолога
• Маммография, УЗИ молочных желез
• При раке - онкологическое лечение
• Контроль СА 15-3 для мониторинга эффективности лечения
• Контроль каждые 3 месяца`
  },

  "CA199": {
    maintenance: `**Для профилактики рака поджелудочной:**
• Отказ от курения
• Ограничение алкоголя
• Здоровое питание
• Контроль диабета
• Поддержание нормального веса`,
    improvement: `**При повышенном СА 19-9:**
• Обследоваться у онколога
• КТ/МРТ поджелудочной железы и желчевыводящих путей
• При раке - онкологическое лечение
• Контроль СА 19-9 для мониторинга
• Лечить холестаз (может повышать СА 19-9)`
  },

  "CEA": {
    maintenance: `**Для профилактики колоректального рака:**
• Колоноскопия после 45 лет
• Здоровое питание с клетчаткой
• Отказ от курения
• Ограничение красного мяса
• Регулярная физическая активность`,
    improvement: `**При повышенном РЭА:**
• Обследоваться у онколога
• Колоноскопия
• КТ грудной клетки, брюшной полости
• При раке - онкологическое лечение
• Бросить курить (курение повышает РЭА)
• Контроль РЭА для мониторинга лечения`
  },

  "AFP": {
    maintenance: `**Для профилактики рака печени:**
• Вакцинация против гепатита B
• Ограничение алкоголя
• Контроль хронических гепатитов
• Здоровое питание`,
    improvement: `**При повышенном АФП:**
• Обследоваться у онколога/гепатолога
• УЗИ, КТ/МРТ печени
• При раке печени - онкологическое лечение
• Лечить хронический гепатит
• Контроль АФП каждые 3 месяца
• Исключить герминогенные опухоли`
  },

  "HCG": {
    maintenance: `**Для нормального ХГЧ:**
• Регулярные гинекологические осмотры
• Контроль беременности
• Профилактика трофобластических заболеваний`,
    improvement: `**При повышенном ХГЧ (вне беременности):**
• Обследоваться у онколога
• КТ грудной клетки, брюшной полости, малого таза
• При трофобластической болезни - химиотерапия
• При герминогенных опухолях - онкологическое лечение
• Контроль ХГЧ еженедельно до нормализации`
  },

  "CALC": {
    maintenance: `**Для поддержания нормального кальцитонина:**
• Регулярные обследования ЩЖ
• Здоровый образ жизни
• Контроль при семейной форме медуллярного рака`,
    improvement: `**При повышенном кальцитонине:**
• Обследоваться у эндокринолога/онколога
• УЗИ, сцинтиграфия ЩЖ
• При медуллярном раке - тиреоидэктомия
• Генетическое тестирование (семейные формы)
• Контроль кальцитонина после лечения`
  },

  "CGA": {
    maintenance: `**Для профилактики нейроэндокринных опухолей:**
• Здоровый образ жизни
• Регулярные обследования
• Контроль хронических заболеваний`,
    improvement: `**При повышенном хромогранине А:**
• Обследоваться у онколога
• КТ/МРТ для поиска нейроэндокринной опухоли
• Сцинтиграфия с октреотидом
• При карциноиде - хирургическое лечение
• Аналоги соматостатина
• Контроль ХгА для мониторинга`
  },

  "NSE": {
    maintenance: `**Для профилактики рака легкого:**
• Отказ от курения
• Избегать пассивного курения
• Избегать канцерогенов
• Регулярные обследования (при факторах риска)`,
    improvement: `**При повышенном NSE:**
• Обследоваться у онколога
• КТ грудной клетки
• При мелкоклеточном раке легкого - химиотерапия
• Бросить курить
• Контроль NSE для мониторинга лечения`
  },

  "HCV": {
    maintenance: `**Для профилактики гепатита C:**
• Избегать контакта с кровью
• Использовать одноразовые шприцы
• Безопасный секс
• Стерильные инструменты (тату, пирсинг)`,
    improvement: `**При положительном Anti-HCV:**
• Подтвердить РНК HCV (ПЦР)
• Обследоваться у гепатолога
• Противовирусная терапия (софосбувир, даклатасвир)
• Контроль функции печени
• Исключить алкоголь
• Контроль вирусной нагрузки
• Лечение до достижения УВО (устойчивого вирусологического ответа)`
  },

  "HBSAG": {
    maintenance: `**Для профилактики гепатита B:**
• Вакцинация против гепатита B
• Избегать контакта с кровью
• Безопасный секс
• Использовать одноразовые шприцы`,
    improvement: `**При положительном HBsAg:**
• Обследоваться у гепатолога
• Определить ДНК HBV, HBeAg
• Противовирусная терапия (тенофовир, энтекавир)
• Контроль функции печени
• Исключить алкоголь
• Контроль вирусной нагрузки каждые 3-6 месяцев
• Скрининг на рак печени (АФП, УЗИ каждые 6 месяцев)`
  },

  "HIV": {
    maintenance: `**Для профилактики ВИЧ:**
• Безопасный секс (презервативы)
• Избегать контакта с кровью
• Использовать одноразовые шприцы
• ПрЭП (доконтактная профилактика) при высоком риске`,
    improvement: `**При положительном Anti-HIV:**
• Подтвердить ВИЧ-инфекцию (иммуноблот, ПЦР)
• Срочная консультация инфекциониста
• Начать АРВТ как можно раньше
• Контроль CD4 и вирусной нагрузки
• Профилактика оппортунистических инфекций
• Приверженность терапии (>95%)
• Контроль каждые 3-6 месяцев
• Цель - неопределяемая вирусная нагрузка`
  },

  "RPR": {
    maintenance: `**Для профилактики сифилиса:**
• Безопасный секс
• Использование презервативов
• Обследование половых партнеров`,
    improvement: `**При положительном RPR:**
• Подтвердить сифилис (РПГА, ИФА)
• Лечение бензилпенициллином
• Обследование и лечение половых партнеров
• Контроль RPR через 3, 6, 12 месяцев
• Серологический контроль излеченности`
  },

  "TOXO_G": {
    maintenance: `**Для профилактики токсоплазмоза:**
• Термическая обработка мяса
• Мытье овощей и фруктов
• Гигиена при контакте с кошками
• Особая осторожность при беременности`,
    improvement: `**При отсутствии IgG (нет иммунитета):**
• Соблюдать профилактические меры
• При беременности - особая осторожность
• Контроль IgM при беременности

**При положительном IgG:**
• Это норма (перенесенная инфекция)
• Контролировать IgM (при беременности)`
  },

  "RUB_G": {
    maintenance: `**Для поддержания иммунитета к краснухе:**
• Вакцинация (если нет иммунитета)
• Ревакцинация по показаниям`,
    improvement: `**При отсутствии IgG:**
• Вакцинация против краснухи
• Особенно важно для женщин детородного возраста
• Контроль антител через 1 месяц после вакцинации`
  },

  "CMV_G": {
    maintenance: `**Для профилактики ЦМВ:**
• Гигиена рук
• Избегать контакта со слюной детей
• Особая осторожность при беременности`,
    improvement: `**При положительном IgG:**
• Это норма (перенесенная инфекция)
• Контролировать IgM при беременности
• При иммунодефиците - противовирусная терапия`
  },

  "HSV_G": {
    maintenance: `**Для профилактики герпеса:**
• Укрепление иммунитета
• Избегать переохлаждения и стрессов
• Защита от солнца (губы)`,
    improvement: `**При положительном IgG:**
• Это норма (перенесенная инфекция)
• При рецидивах - противовирусная терапия (ацикловир)
• Укрепление иммунитета
• Супрессивная терапия (при частых рецидивах)`
  },

  "ZN": {
    maintenance: `**Для поддержания нормального цинка:**
• Достаточное потребление цинка (мясо, морепродукты, орехи, семена)
• Сбалансированное питание
• Ограничение фитатов (замачивать крупы и бобовые)`,
    improvement: `**При дефиците цинка:**
• Принимать препараты цинка (15-30 мг/день)
• Увеличить потребление цинка (устрицы, говядина, тыквенные семечки)
• Лечить мальабсорбцию
• Контроль через 2-3 месяца
• Симптомы дефицита: выпадение волос, плохое заживление ран, снижение иммунитета`
  },

  "CU": {
    maintenance: `**Для поддержания нормальной меди:**
• Сбалансированное питание
• Достаточное потребление меди (морепродукты, орехи, печень)
• Контроль при болезни Вильсона (наследственность)`,
    improvement: `**При дефиците меди:**
• Увеличить потребление меди (морепродукты, орехи, шоколад)
• Принимать препараты меди (2-3 мг/день)
• Лечить мальабсорбцию

**При избытке меди:**
• Обследоваться на болезнь Вильсона
• Ограничить медь в питании
• Принимать D-пеницилламин (хелатор меди)
• Контролировать функцию печени
• Генетическое тестирование`
  },

  "SE": {
    maintenance: `**Для поддержания нормального селена:**
• Достаточное потребление селена (бразильские орехи, морепродукты, мясо)
• Сбалансированное питание
• Избегать дефицита и избытка`,
    improvement: `**При дефиците селена:**
• Принимать селен (100-200 мкг/день)
• Увеличить потребление бразильских орехов (2-3 ореха в день)
• Добавить морепродукты
• Контроль через 3 месяца

**При избытке селена:**
• Ограничить селен в питании
• Прекратить прием добавок
• Контролировать симптомы токсичности`
  },

  "I": {
    maintenance: `**Для поддержания нормального йода:**
• Использовать йодированную соль
• Достаточное потребление морепродуктов
• Контроль функции ЩЖ`,
    improvement: `**При дефиците йода:**
• Использовать йодированную соль
• Увеличить потребление морепродуктов
• Принимать препараты йода (150-200 мкг/день)
• Контролировать функцию ЩЖ
• При беременности - 250 мкг/день

**При избытке йода:**
• Ограничить йод
• Контролировать функцию ЩЖ
• Избегать йодсодержащих препаратов`
  },

  "CR": {
    maintenance: `**Для поддержания нормального хрома:**
• Сбалансированное питание
• Достаточное потребление хрома (цельнозерновые, брокколи, мясо)
• Ограничение простых углеводов`,
    improvement: `**При дефиците хрома:**
• Принимать пиколинат хрома (200-400 мкг/день)
• Увеличить потребление цельнозерновых
• Добавить брокколи, зеленую фасоль
• Контролировать уровень глюкозы
• Может улучшить чувствительность к инсулину`
  },

  "MICRO": {
    maintenance: `**Для профилактики инфекций:**
• Гигиена
• Укрепление иммунитета
• Своевременное лечение инфекций
• Избегать самолечения антибиотиками`,
    improvement: `**При выделении патогенной микрофлоры:**
• Антибиотикотерапия по результатам чувствительности
• Полный курс антибиотиков (не прерывать)
• Контрольный посев после лечения
• Лечить сопутствующие заболевания
• Укреплять иммунитет`
  },

  "SENS": {
    maintenance: `**Для профилактики резистентности:**
• Не принимать антибиотики без назначения
• Завершать полный курс антибиотикотерапии
• Не использовать антибиотики при вирусных инфекциях`,
    improvement: `**При резистентности:**
• Выбрать антибиотик, к которому есть чувствительность
• Рассмотреть комбинированную терапию
• Увеличить дозу или длительность лечения
• Контрольный посев после лечения`
  }
};

async function main() {
  console.log('📝 Добавление рекомендаций (Часть 3)...');

  try {
    let updated = 0;
    let notFound = 0;

    for (const [code, rec] of Object.entries(recommendationsPart3)) {
      const indicator = await prisma.indicator.findFirst({
        where: { code: code }
      });

      if (indicator) {
        await prisma.indicator.update({
          where: { id: indicator.id },
          data: {
            maintenanceRecommendations: rec.maintenance,
            improvementRecommendations: rec.improvement
          }
        });
        updated++;
        console.log(`✅ ${indicator.name} (${code})`);
      } else {
        console.log(`⚠️ Не найден показатель с кодом: ${code}`);
        notFound++;
      }
    }

    console.log(`\n🎉 Часть 3 завершена!`);
    console.log(`📊 Обновлено показателей: ${updated}`);
    console.log(`⚠️ Не найдено: ${notFound}`);

    // Итоговая статистика
    const totalWithRecommendations = await prisma.indicator.count({
      where: {
        maintenanceRecommendations: { not: null }
      }
    });

    const totalIndicators = await prisma.indicator.count();

    console.log(`\n📊 ИТОГОВАЯ СТАТИСТИКА:`);
    console.log(`   Всего показателей: ${totalIndicators}`);
    console.log(`   С рекомендациями: ${totalWithRecommendations}`);
    console.log(`   Без рекомендаций: ${totalIndicators - totalWithRecommendations}`);
    console.log(`   Покрытие: ${Math.round(totalWithRecommendations / totalIndicators * 100)}%`);

  } catch (error) {
    console.error('❌ Ошибка:', error);
    throw error;
  }
}

main()
  .catch((e) => {
    console.error('❌ Критическая ошибка:', e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });
