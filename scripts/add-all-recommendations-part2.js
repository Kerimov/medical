const { PrismaClient } = require('@prisma/client');

const prisma = new PrismaClient();

// Рекомендации для показателей - Часть 2 (Гормоны, Анализы мочи, Витамины)
const recommendationsPart2 = {
  "FT3": {
    maintenance: `**Для поддержания нормального Т3:**
• Достаточное потребление йода
• Селен для конверсии Т4 в Т3
• Контроль функции щитовидной железы
• Избегать стрессов`,
    improvement: `**При низком Т3:**
• Принимать левотироксин (конвертируется в Т3)
• Добавить селен (100-200 мкг/день)
• Обследовать надпочечники
• Исключить синдром низкого Т3

**При высоком Т3:**
• Принимать тиреостатики
• Контролировать сердечный ритм
• Рассмотреть радиойодтерапию`
  },

  "ATPO": {
    maintenance: `**Для профилактики повышения АТ-ТПО:**
• Достаточное потребление селена
• Контроль стресса
• Здоровый образ жизни
• Избегать избытка йода`,
    improvement: `**При повышенных АТ-ТПО:**
• Принимать селен (200 мкг/день) - может снизить антитела
• Контролировать функцию ЩЖ (ТТГ, Т4)
• Принимать левотироксин при гипотиреозе
• Избегать избытка йода
• Контролировать антитела 1 раз в год
• Лечить аутоиммунный тиреоидит`
  },

  "TEST": {
    maintenance: `**Для поддержания нормального тестостерона:**
• Регулярные силовые тренировки
• Достаточный сон (7-9 часов)
• Поддержание нормального веса
• Сбалансированное питание с цинком
• Контроль стресса
• Ограничение алкоголя`,
    improvement: `**При низком тестостероне:**
• Увеличить силовые тренировки
• Снизить вес при ожирении
• Улучшить качество сна
• Добавить цинк (15-30 мг/день) и витамин D
• Ограничить алкоголь
• Принимать тестостерон (по назначению эндокринолога)
• Обследоваться на гипогонадизм
• Контролировать уровень эстрадиола`
  },

  "E2": {
    maintenance: `**Для поддержания нормального эстрадиола:**
• Сбалансированное питание
• Поддержание нормального веса
• Регулярная физическая активность
• Контроль менструального цикла`,
    improvement: `**При низком эстрадиоле:**
• Заместительная гормональная терапия (при менопаузе)
• Обследоваться на причину (яичниковая недостаточность)
• Поддерживать нормальный вес
• Избегать чрезмерных физических нагрузок

**При высоком эстрадиоле:**
• Снизить вес при ожирении
• Увеличить потребление клетчатки
• Ограничить алкоголь
• Обследоваться на опухоли яичников`
  },

  "PROG": {
    maintenance: `**Для поддержания нормального прогестерона:**
• Здоровый менструальный цикл
• Контроль стресса
• Достаточный сон
• Сбалансированное питание`,
    improvement: `**При низком прогестероне:**
• Принимать прогестерон (при планировании беременности)
• Лечить недостаточность желтого тела
• Контролировать овуляцию
• Снизить стресс
• Витамин B6 и магний`
  },

  "LH": {
    maintenance: `**Для поддержания нормального ЛГ:**
• Здоровый образ жизни
• Поддержание нормального веса
• Контроль стресса`,
    improvement: `**При отклонениях ЛГ:**
• Обследоваться у эндокринолога
• Лечить основное заболевание
• Контролировать вес
• При СПКЯ - метформин, КОК`
  },

  "FSH": {
    maintenance: `**Для поддержания нормального ФСГ:**
• Здоровый образ жизни
• Поддержание нормального веса
• Контроль репродуктивной функции`,
    improvement: `**При отклонениях ФСГ:**
• Обследоваться у эндокринолога/гинеколога
• Лечить основное заболевание
• При менопаузе - ЗГТ (по показаниям)
• При гипогонадизме - гормональная терапия`
  },

  "PRL": {
    maintenance: `**Для поддержания нормального пролактина:**
• Контроль стресса
• Достаточный сон
• Избегать стимуляции сосков
• Осторожность с нейролептиками`,
    improvement: `**При повышенном пролактине:**
• Исключить физиологические причины (беременность, лактация, стресс)
• Отменить препараты, повышающие пролактин (нейролептики, метоклопрамид)
• МРТ гипофиза для исключения пролактиномы
• Принимать агонисты дофамина (каберголин, бромокриптин)
• Контроль пролактина через 1-3 месяца
• При макропролактиноме - нейрохирургическое лечение`
  },

  "DHEAS": {
    maintenance: `**Для поддержания нормального ДГЭА-С:**
• Здоровый образ жизни
• Контроль стресса
• Поддержание нормального веса`,
    improvement: `**При повышенном ДГЭА-С:**
• Обследоваться на опухоли надпочечников
• Лечить СПКЯ (метформин, КОК)
• Контролировать гиперандрогению
• Снизить вес при ожирении`
  },

  "17OHP": {
    maintenance: `**Для поддержания нормального 17-ОП:**
• Здоровый образ жизни
• Контроль функции надпочечников`,
    improvement: `**При повышенном 17-ОП:**
• Обследоваться на ВДКН
• Генетическое тестирование
• Заместительная терапия глюкокортикоидами
• Контроль электролитов`
  },

  "CORT": {
    maintenance: `**Для поддержания нормального кортизола:**
• Контроль стресса (медитация, йога)
• Достаточный сон (7-9 часов)
• Регулярная физическая активность
• Сбалансированное питание`,
    improvement: `**При низком кортизоле:**
• Обследоваться на недостаточность надпочечников
• Заместительная терапия гидрокортизоном
• Увеличить потребление соли
• Избегать стрессов
• Носить медицинский браслет

**При высоком кортизоле:**
• Снизить стресс
• Улучшить качество сна
• Обследоваться на синдром Кушинга
• Лечить опухоли гипофиза/надпочечников
• Принимать блокаторы синтеза кортизола (по назначению)`
  },

  "ACTH": {
    maintenance: `**Для поддержания нормального АКТГ:**
• Контроль стресса
• Здоровый образ жизни
• Достаточный сон`,
    improvement: `**При отклонениях АКТГ:**
• Обследоваться у эндокринолога
• МРТ гипофиза
• Лечить основное заболевание
• Заместительная терапия (при недостаточности)`
  },

  "ALDO": {
    maintenance: `**Для поддержания нормального альдостерона:**
• Умеренное потребление соли
• Контроль АД
• Достаточное потребление калия`,
    improvement: `**При повышенном альдостероне:**
• Обследоваться на гиперальдостеронизм
• КТ надпочечников
• Принимать спиронолактон
• Хирургическое лечение (при аденоме)
• Контролировать АД и калий`
  },

  "RENIN": {
    maintenance: `**Для поддержания нормального ренина:**
• Контроль АД
• Умеренное потребление соли
• Здоровый образ жизни`,
    improvement: `**При отклонениях ренина:**
• Обследоваться на реноваскулярную гипертонию
• Лечить заболевания почек
• Контролировать АД
• Принимать иАПФ/БРА (по назначению)`
  },

  "ERY_U": {
    maintenance: `**Для предотвращения гематурии:**
• Достаточное потребление воды
• Избегать травм поясницы
• Профилактика МКБ
• Контроль АД`,
    improvement: `**При гематурии:**
• Обильное питье
• Обследоваться для выявления причины (УЗИ почек, цистоскопия)
• Лечить гломерулонефрит (при наличии)
• Удалить камни (при МКБ)
• Лечить опухоли мочевыводящих путей
• Контролировать АД при гломерулонефрите
• Избегать НПВС`
  },

  "GLU_U": {
    maintenance: `**Для предотвращения глюкозурии:**
• Контроль уровня глюкозы крови
• Профилактика диабета
• Здоровое питание`,
    improvement: `**При глюкозурии:**
• Контролировать уровень глюкозы крови
• Лечить сахарный диабет
• Обследовать почки (исключить почечную глюкозурию)
• Контролировать HbA1c`
  },

  "KET": {
    maintenance: `**Для предотвращения кетонурии:**
• Сбалансированное питание
• Достаточное потребление углеводов
• Контроль диабета`,
    improvement: `**При кетонурии:**
• При диабете - срочная коррекция инсулинотерапии
• Увеличить потребление углеводов
• Обильное питье
• При кетоацидозе - госпитализация
• Контролировать глюкозу крови
• Исключить голодание`
  },

  "SG": {
    maintenance: `**Для поддержания нормального удельного веса:**
• Достаточное потребление воды
• Контроль функции почек
• Сбалансированное питание`,
    improvement: `**При низком удельном весе:**
• Обследовать концентрационную функцию почек
• Лечить несахарный диабет (при наличии)
• Контролировать потребление жидкости

**При высоком удельном весе:**
• Увеличить потребление воды
• Контролировать глюкозу (при глюкозурии)
• Лечить обезвоживание`
  },

  "PH_U": {
    maintenance: `**Для поддержания нормального pH мочи:**
• Сбалансированное питание
• Достаточное потребление воды
• Контроль кислотно-основного состояния`,
    improvement: `**При кислой моче (низкий pH):**
• Увеличить потребление овощей и фруктов
• Ограничить мясо
• Контролировать диабет
• Профилактика уратных камней

**При щелочной моче (высокий pH):**
• Лечить инфекции МВП
• Контролировать кислотно-основное состояние
• Профилактика фосфатных камней`
  },

  "B12": {
    maintenance: `**Для поддержания нормального B12:**
• Достаточное потребление B12 (мясо, рыба, яйца, молочные продукты)
• Для вегетарианцев - обязательный прием добавок
• Контроль функции ЖКТ`,
    improvement: `**При низком B12:**
• Принимать витамин B12 (1000 мкг/день перорально или 1000 мкг в/м 1 раз в месяц)
• Увеличить потребление животных продуктов
• Лечить мальабсорбцию (при наличии)
• Лечить атрофический гастрит
• Контроль B12 через 3 месяца
• При неврологических симптомах - высокие дозы`
  },

  "FOLIC": {
    maintenance: `**Для поддержания нормальной фолиевой кислоты:**
• Достаточное потребление фолатов (зеленые овощи, бобовые, цитрусовые)
• Ограничение алкоголя
• Контроль при беременности`,
    improvement: `**При низких фолатах:**
• Принимать фолиевую кислоту (400-1000 мкг/день)
• Увеличить потребление зеленых овощей
• Ограничить алкоголь
• Лечить мальабсорбцию
• При беременности - 400-800 мкг/день
• Контроль через 2-3 месяца`
  },

  "VIT_D": {
    maintenance: `**Для поддержания нормального витамина D:**
• Умеренное пребывание на солнце (15-30 минут в день)
• Потребление витамина D (800-1000 МЕ/день)
• Жирная рыба, яйца, обогащенные продукты`,
    improvement: `**При дефиците витамина D:**
• Принимать витамин D3 (2000-4000 МЕ/день для поддержания)
• При дефиците - нагрузочная доза 50000 МЕ 1 раз в неделю 8 недель
• Увеличить пребывание на солнце
• Добавить жирную рыбу (лосось, сардины)
• Контроль витамина D через 3 месяца
• Целевой уровень >30 нг/мл
• Принимать кальций вместе с витамином D`
  },

  "FIB": {
    maintenance: `**Для поддержания нормального фибриногена:**
• Противовоспалительная диета
• Контроль воспалительных заболеваний
• Здоровый образ жизни`,
    improvement: `**При низком фибриногене:**
• Лечить ДВС-синдром (при наличии)
• Переливание свежезамороженной плазмы (при кровотечении)
• Лечить заболевания печени

**При высоком фибриногене:**
• Лечить воспалительные заболевания
• Противовоспалительная диета
• Контролировать риск тромбозов
• Принимать антиагреганты (по назначению)`
  },

  "APTT": {
    maintenance: `**Для поддержания нормального АЧТВ:**
• Контроль гемостаза
• Избегать травм
• Осторожность с антикоагулянтами`,
    improvement: `**При удлиненном АЧТВ:**
• Обследоваться на дефицит факторов свертывания
• Лечить гемофилию (при наличии)
• Скорректировать дозу гепарина
• Избегать травм

**При укороченном АЧТВ:**
• Контролировать риск тромбозов
• Принимать антикоагулянты (по показаниям)`
  },

  "DDIM": {
    maintenance: `**Для поддержания низкого Д-димера:**
• Профилактика тромбозов
• Регулярная физическая активность
• Избегать длительной иммобилизации
• Достаточное потребление воды`,
    improvement: `**При повышенном Д-димере:**
• Обследоваться на тромбоз (УЗИ вен, КТ-ангиография)
• При тромбозе - антикоагулянтная терапия
• При ТЭЛА - срочная госпитализация
• Компрессионный трикотаж
• Ранняя активизация после операций
• Контролировать Д-димер в динамике`
  },

  "CD3": {
    maintenance: `**Для поддержания нормальных Т-лимфоцитов:**
• Укрепление иммунитета
• Здоровое питание
• Достаточный сон
• Контроль стресса`,
    improvement: `**При низких CD3+:**
• Обследоваться на иммунодефицит
• Лечить ВИЧ (при наличии)
• Принимать иммуномодуляторы (по назначению)
• Избегать контактов с больными`
  },

  "CD4": {
    maintenance: `**Для поддержания нормальных Т-хелперов:**
• Укрепление иммунитета
• Здоровый образ жизни
• Профилактика ВИЧ`,
    improvement: `**При низких CD4+:**
• При ВИЧ - антиретровирусная терапия
• Профилактика оппортунистических инфекций
• Контроль CD4 каждые 3-6 месяцев
• Целевой уровень >500 клеток/мкл`
  },

  "CD8": {
    maintenance: `**Для поддержания нормальных Т-супрессоров:**
• Здоровый образ жизни
• Контроль иммунного статуса`,
    improvement: `**При отклонениях CD8+:**
• Обследоваться на иммунные нарушения
• Лечить основное заболевание
• Контролировать соотношение CD4/CD8`
  },

  "CD19": {
    maintenance: `**Для поддержания нормальных В-лимфоцитов:**
• Укрепление иммунитета
• Здоровое питание
• Профилактика инфекций`,
    improvement: `**При отклонениях CD19+:**
• Обследоваться на иммунодефицит
• Лечить аутоиммунные заболевания
• Контролировать иммуноглобулины`
  },

  "IGG": {
    maintenance: `**Для поддержания нормального IgG:**
• Сбалансированное питание с белком
• Укрепление иммунитета
• Своевременная вакцинация`,
    improvement: `**При низком IgG:**
• Обследоваться на иммунодефицит
• Заместительная терапия иммуноглобулинами
• Лечить хронические инфекции

**При высоком IgG:**
• Лечить хронические инфекции
• Обследоваться на аутоиммунные заболевания`
  },

  "IGM": {
    maintenance: `**Для поддержания нормального IgM:**
• Укрепление иммунитета
• Профилактика инфекций
• Здоровый образ жизни`,
    improvement: `**При низком IgM:**
• Обследоваться на иммунодефицит
• Избегать контактов с больными

**При высоком IgM:**
• Лечить острую инфекцию
• Обследоваться на макроглобулинемию Вальденстрема`
  },

  "IGE": {
    maintenance: `**Для поддержания нормального IgE:**
• Контроль аллергий
• Избегать аллергенов
• Профилактика паразитозов`,
    improvement: `**При повышенном IgE:**
• Выявить и устранить аллергены
• Принимать антигистаминные препараты
• Обследоваться на паразитозы
• Лечить бронхиальную астму
• Рассмотреть АСИТ (аллерген-специфическую иммунотерапию)
• Принимать омализумаб (при тяжелой астме)`
  },

  "ECP": {
    maintenance: `**Для поддержания низкого ECP:**
• Контроль аллергий
• Избегать аллергенов
• Противовоспалительная терапия`,
    improvement: `**При повышенном ECP:**
• Усилить противоаллергическую терапию
• Ингаляционные кортикостероиды (при астме)
• Устранить контакт с аллергенами
• Контроль эозинофилов крови`
  },

  "TRYP": {
    maintenance: `**Для поддержания нормальной триптазы:**
• Избегать триггеров анафилаксии
• Контроль аллергий
• Носить автоинжектор с адреналином (при анафилаксии в анамнезе)`,
    improvement: `**При повышенной триптазе:**
• Обследоваться на мастоцитоз
• Избегать триггеров дегрануляции тучных клеток
• Принимать антигистаминные препараты
• Носить автоинжектор с адреналином
• Консультация аллерголога-иммунолога`
  },

  "RETIC": {
    maintenance: `**Для поддержания нормальных ретикулоцитов:**
• Здоровье костного мозга
• Достаточное потребление железа, B12, фолатов
• Профилактика анемий`,
    improvement: `**При низких ретикулоцитах:**
• Обследоваться на апластическую анемию
• Лечить угнетение костного мозга
• Отменить миелотоксичные препараты
• Стимуляция эритропоэза (эритропоэтин)

**При высоких ретикулоцитах:**
• Хороший признак при лечении анемии
• Продолжать лечение анемии
• При гемолизе - лечить причину`
  },

  "LEU_N": {
    maintenance: `**Для предотвращения лейкоцитурии (Нечипоренко):**
• Достаточное потребление воды
• Гигиена мочеполовых органов
• Профилактика ИМП`,
    improvement: `**При лейкоцитурии:**
• Обильное питье (2.5-3 литра)
• Антибиотикотерапия по результатам посева
• Уросептики
• Лечить пиелонефрит/цистит
• Контрольный анализ после лечения`
  },

  "ERY_N": {
    maintenance: `**Для предотвращения эритроцитурии (Нечипоренко):**
• Достаточное потребление воды
• Профилактика МКБ
• Контроль АД`,
    improvement: `**При эритроцитурии:**
• Обследоваться для выявления причины
• Лечить гломерулонефрит
• Удалить камни при МКБ
• Контролировать АД
• Исключить опухоли МВП`
  },

  "DAY_DIUR": {
    maintenance: `**Для поддержания нормального дневного диуреза:**
• Достаточное потребление воды днем
• Сбалансированное питание
• Контроль функции почек`,
    improvement: `**При отклонениях дневного диуреза:**
• Обследовать концентрационную функцию почек
• Контролировать потребление жидкости
• Лечить заболевания почек`
  },

  "NIGHT_DIUR": {
    maintenance: `**Для предотвращения никтурии:**
• Ограничить жидкость за 2-3 часа до сна
• Контроль функции почек
• Лечить аденому простаты (у мужчин)`,
    improvement: `**При никтурии:**
• Ограничить жидкость вечером
• Лечить аденому простаты
• Лечить заболевания почек
• Контролировать сердечную недостаточность
• Лечить несахарный диабет (при наличии)`
  },

  "PROT_24H": {
    maintenance: `**Для предотвращения протеинурии:**
• Контроль АД (<130/80)
• Контроль глюкозы при диабете
• Ограничение соли
• Здоровье почек`,
    improvement: `**При протеинурии:**
• Строгий контроль АД (<125/75)
• Ограничение белка (0.6-0.8 г/кг)
• Ограничение соли (<5 г/день)
• Принимать иАПФ или БРА
• Контролировать глюкозу при диабете
• Наблюдение нефролога
• Контроль протеинурии каждые 3 месяца`
  }
};

async function main() {
  console.log('📝 Добавление рекомендаций (Часть 2)...');

  try {
    let updated = 0;

    for (const [code, rec] of Object.entries(recommendationsPart2)) {
      const indicator = await prisma.indicator.findFirst({
        where: { code: code }
      });

      if (indicator) {
        await prisma.indicator.update({
          where: { id: indicator.id },
          data: {
            maintenanceRecommendations: rec.maintenance,
            improvementRecommendations: rec.improvement
          }
        });
        updated++;
        console.log(`✅ ${indicator.name} (${code})`);
      } else {
        console.log(`⚠️ Не найден показатель с кодом: ${code}`);
      }
    }

    console.log(`\n🎉 Часть 2 завершена!`);
    console.log(`📊 Обновлено показателей: ${updated}`);

  } catch (error) {
    console.error('❌ Ошибка:', error);
    throw error;
  }
}

main()
  .catch((e) => {
    console.error('❌ Критическая ошибка:', e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });
